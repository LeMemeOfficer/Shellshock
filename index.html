<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<link rel="stylesheet" type="text/css" href="style.css">
<body onload="startGame()">
<script src="figure.js"></script>
<script src="figureHelpers.js"></script>
<script src="ground.js"></script>
<script src="groundHelpers.js"></script>
<script src="helpers.js"></script>
<script src="keyboardControls.js"></script>
<script src="keyboardControlsHelper.js"></script>
<script>
//--------------------PARAMETER--------------------
var CANVAS_HEIGHT = 600;
var CANVAS_WIDTH = 1000;
//--------------------PARAMETER--------------------

var players = [new figure(25, 18, 0, "red", 60, 120, 65, 68, 0),
               new figure(25, 18, 0, "blue", CANVAS_WIDTH - 60, 120, 100, 102, 1)];
var ground = new ground();

function startGame()
{
    myGameArea.start();
    groundCanvas.start();
    ground.createGroundMatrix();
    ground.drawGround();
    players.forEach(player => player.update());
}

var myGameArea = {
    canvas : document.createElement("canvas"),
    start : function()
    {
      this.canvas.width = CANVAS_WIDTH;
      this.canvas.height = CANVAS_HEIGHT;
      this.context = this.canvas.getContext("2d");
      document.body.insertBefore(this.canvas, document.body.childNodes[0]);
      this.interval = setInterval(updateGameArea, 40);
    },
    clear : function()
    {
      this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }
}

var groundCanvas = {
  canvas : document.createElement("canvas"),
  start : function()
  {
    this.canvas.width = CANVAS_WIDTH;
    this.canvas.height = CANVAS_HEIGHT;
    this.context = this.canvas.getContext("2d");
    document.body.insertBefore(this.canvas, document.body.childNodes[0]);
  },
  clear : function()
  {
    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
  }
}

function updateGameArea()
{
  myGameArea.clear();
  players.forEach(player => player.newPos(getPlayerGround(player.id)));
  players.forEach(player => player.update());
}

function getPlayerGround(playerId)
{
  groundHeights = [ground.groundMatrix[ players[playerId].x      / 2], //ground heigth at tank center
                   ground.groundMatrix[(players[playerId].x - 8) / 2], //ground heigth at left offset
                   ground.groundMatrix[(players[playerId].x + 8) / 2]];//ground heigth at right offset
  return groundHeights;
}

</script>

<p id="log"></p>

</body>
</html>
