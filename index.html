<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="style.css">
<body onload="startGame()">
<script src="bullet.js"></script>
<script src="bulletHelpers.js"></script>
<script src="calculations.js"></script>
<script src="drawHelpers.js"></script>
<script src="explosion.js"></script>
<script src="figure.js"></script>
<script src="figureHelpers.js"></script>
<script src="gameLogicHelpers.js"></script>
<script src="gameWindows.js"></script>
<script src="ground.js"></script>
<script src="groundHelpers.js"></script>
<script src="imageHelpers.js"></script>
<script src="keyboardControls.js"></script>
<script src="keyboardControlsHelper.js"></script>

<script>
//--------------------PARAMETER--------------------
var CANVAS_HEIGHT = 600;
var CANVAS_WIDTH = 1000;
//--------------------PARAMETER--------------------
var nextPlayerWindow = new nextPlayerMenu();
var gameStartWindow = new gameStartScreen();
var gameFinishedWindow = new gameFinishedScreen();
var chooseGameModeWindow = new chooseGameModeScreen();

var isSinglePlayer = false;
var gameMode = BOTMODE_EASY;

var mouseOverButton = "none";
var shotFired = false;
var roundEnded = false;
var soundOn = true;
var musicOn = true;

var bulletsArray = [];
var bulletId = new counter();

var explosionsArray = [];
var explosionId = new counter();

var toastTextArray = [];
var toastTextId = new counter();

var players = [new figure(38, 26, 0, 60, 120, 65, 68, 0, "Player 1", image_tank_red, image_tank_red_cannon, "#ED2129", false),
               new figure(38, 26, 0, CANVAS_WIDTH - 60, 120, 65, 68, 1, "Player 2", image_tank_blue, image_tank_blue_cannon, "#13A9E9", true)];
var activePlayer = 0;

var ground = new ground();
var mousePosition = [0, 0];

function startGame()
{
    myGameArea.start();
    groundCanvas.start();
    ground.createGroundMatrix();
    ground.drawGround();
    players.forEach(player => player.update());
}

var myGameArea = {
    canvas : document.createElement("canvas"),
    start : function()
    {
      this.canvas.width = CANVAS_WIDTH;
      this.canvas.height = CANVAS_HEIGHT;
      this.canvas.id = "gameArea"
      this.context = this.canvas.getContext("2d");
      document.body.insertBefore(this.canvas, document.body.childNodes[0]);
      this.interval = setInterval(updateGameArea, 40);
    },
    clear : function()
    {
      this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }
}

var groundCanvas = {
  canvas : document.createElement("canvas"),
  start : function()
  {
    this.canvas.width = CANVAS_WIDTH;
    this.canvas.height = CANVAS_HEIGHT;
    this.context = this.canvas.getContext("2d");
    document.body.insertBefore(this.canvas, document.body.childNodes[0]);
  },
  clear : function()
  {
    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
  }
}

function updateGameArea()
{
  myGameArea.clear();
  if(players[activePlayer].isBot && isSinglePlayer)
  {
    players[activePlayer].botMove();
  }
  drawMenuBar();
  if(!gameStartWindow.active)
  {
    players.forEach(player => player.update());
    toastTextArray.forEach(toastText => toastText.update());
    players.forEach(player => drawPlayerGui(player.id));
    if(!nextPlayerWindow.active)
    {
      players[activePlayer].newPos();
      bulletsArray.forEach(bullet => bullet.update());
      explosionsArray.forEach(explosion => explosion.update());
      drawShootSpeedCone(players[activePlayer]);
    }
  }
  if(numberPlayersLeft() == 1)
  {
    gameFinishedWindow.activate();
  }
  if(nextPlayerWindow.active)
  {
    nextPlayerWindow.draw();
  }
  if(gameStartWindow.active)
  {
    gameStartWindow.draw();
  }
  if(gameFinishedWindow.active)
  {
    gameFinishedWindow.draw();
  }
  if(chooseGameModeWindow.active)
  {
   chooseGameModeWindow.draw();
  }
  if(shotFired && !roundEnded)
  {
    waitForRoundEnd();
  }
  if(roundEnded)
  {
    if(!players[getNextPlayerId(activePlayer)].isBot)
    {
      nextPlayerWindow.activate(players[getNextPlayerId(activePlayer)].name);
    }
    else
    {
      getNextPlayer();
    }
  }
}
</script>

<p id="log"></p>

</body>
</html>
